<div class="table-container">
  <table class="table oc-mb-0"
         [infiniteScrollThrottle]="50"
         (scrolled)="onScrollDown()"
         infiniteScroll>
    <thead>
    <tr>
      <th class="placeholder"></th>
      <th class="name cursor-pointer" (click)="sortAppsBy('name')">Name
      <img [src]="sortingObjects[0].ascending ? ascendingSortIcon ? ascendingSortIcon
      : descendingSortIcon : descendingSortIcon"
           alt="icon" class="icon-down"
           *ngIf="ascendingSortIcon || descendingSortIcon"
           [class.icon-up]="!ascendingSortIcon && sortingObjects[0].ascending">
        <svg-icon src="assets/oc-ng-common-component/select-down.svg"
               *ngIf="!ascendingSortIcon && !descendingSortIcon && !sortingObjects[0].ascending"></svg-icon>
      <svg-icon src="assets/oc-ng-common-component/select-up.svg"
               *ngIf="!ascendingSortIcon && !descendingSortIcon && sortingObjects[0].ascending"></svg-icon>
      </th>
      <th class="summary">Summary</th>
    <th class="data" (click)="sortAppsBy('created')">Created
      <img [src]="sortingObjects[1].ascending ? ascendingSortIcon ? ascendingSortIcon
      : descendingSortIcon : descendingSortIcon"
           alt="icon" class="cursor-pointer icon-down"
           *ngIf="ascendingSortIcon || descendingSortIcon"
           [class.icon-up]="!ascendingSortIcon && sortingObjects[1].ascending">
      <svg-icon src="assets/oc-ng-common-component/select-down.svg"
               *ngIf="!ascendingSortIcon && !descendingSortIcon && !sortingObjects[1].ascending"></svg-icon>
      <svg-icon src="assets/oc-ng-common-component/select-up.svg"
               *ngIf="!ascendingSortIcon && !descendingSortIcon && sortingObjects[1].ascending"></svg-icon>
      </th>
      <th class="status cursor-pointer" (click)="sortAppsBy('status')">Status
      <img [src]="sortingObjects[2].ascending ? ascendingSortIcon ? ascendingSortIcon
      : descendingSortIcon : descendingSortIcon"
           alt="icon" class="icon-down"
           *ngIf="ascendingSortIcon || descendingSortIcon"
           [class.icon-up]="!ascendingSortIcon && sortingObjects[2].ascending">
        <svg-icon src="assets/oc-ng-common-component/select-down.svg"
               *ngIf="!ascendingSortIcon && !descendingSortIcon && !sortingObjects[2].ascending"></svg-icon>
      <svg-icon src="assets/oc-ng-common-component/select-up.svg"
               *ngIf="!ascendingSortIcon && !descendingSortIcon && sortingObjects[2].ascending"></svg-icon>
      </th>
      <th class="action"></th>
      <th class="placeholder"></th>
    </tr>
    </thead>
    <tbody>
    <ng-template [ngForOf]="properties.data.list" let-app ngFor let-i="index">
      <tr>
        <td class="col-blank"></td>
        <td>
          <div class="row">
            <div class="col-md-auto">
              <img [src]="app.customData.icon ? app.customData.icon : defaultAppIcon" alt="" class="app-icon">
            </div>
            <div class="col-md oc-pl-0">
              <h6 class="app-name cursor-pointer oc-pr-2 word-break"
                  (click)="action('PREVIEW', app.appId, app.version, false)"
              >{{app.name}} </h6>
              <small> v {{app.version}}</small>
            </div>
          </div>
        </td>
        <td>
          <span class="summary-text">{{app.customData.summary ? app.customData.summary : ''}}</span>
        </td>
        <td>
          <span>{{app.created | date:'M/d/yyyy'}}</span>
        </td>
        <td>
          <small *ngIf="app.status.reason">
            <span class="indicator" [ngClass]="app.status.value ? statusColor(app.status.value) : ''"></span>
            <span [ngbPopover]="popContent"
                  class="cursor-pointer font-med oc-text-body" placement="bottom"
                  popoverClass="popover oc-shadow-sm oc-bg-white oc-rounded"
                  popoverTitle="Status Change Reason"
                  triggers="hover">
                {{app.status.value === 'inDevelopment'? 'Draft'
                : app.status.value | camelcase}}
            </span>
          </small>
          <ng-template #popContent>
            {{ app.status.reason }}
          </ng-template>
          <small *ngIf="!app.status.reason">
            <span class="indicator" [ngClass]="app.status.value ? statusColor(app.status.value) : ''"></span>
            <span class="cursor-pointer font-med oc-text-body">
            {{app.status.value === 'inDevelopment'? 'Draft'
                : app.status.value | camelcase}}</span>
          </small>
        </td>
        <td>
          <ng-container [ngTemplateOutletContext]="{ $implicit: {data: app, child: false, index: i} }"
                        [ngTemplateOutlet]="appMenuTemplate">
          </ng-container>
        </td>
        <td class="col-blank"></td>
      </tr>
      <ng-container *ngIf="app.children && app.children.length > 0">
        <tr *ngFor="let child of app?.children; let i = index">
          <td class="col-blank"></td>
          <td>
            <div class="row">
              <div class="col-md-auto">
                <img alt="icon" class="oc-px-3" src="assets/img/line-arrow-down.svg" *ngIf="i === 0">
                <span *ngIf="i > 0" class="oc-px-4"></span>
                <img [src]="child.customData.icon ? child.customData.icon : defaultAppIcon" alt="" class="app-icon">
              </div>
              <div class="col-md oc-pl-0">
                <h6 class="oc-mb-0 cursor-pointer oc-pr-2 word-break"
                    (click)="action('PREVIEW', child.appId, child.version, true)">{{child.name}}</h6>
                <small>v {{child.version}}</small>
              </div>
            </div>
          </td>
          <td>
            <span class="summary-text">{{child.customData.summary ? child.customData.summary : ''}}</span>
          </td>
          <td>
            <span>{{child.created | date:'M/d/yyyy'}}</span>
          </td>
          <td>
            <small *ngIf="child.status.reason">
              <span class="indicator" [ngClass]="child.status.value ? statusColor(app.status.value) : ''"></span>
              <span [ngbPopover]="popContent"
                    class="cursor-pointer font-med oc-text-body" placement="bottom"
                    popoverClass="popover oc-shadow-sm oc-bg-white oc-rounded"
                    popoverTitle="Status Change Reason"
                    triggers="hover">
                {{child.status.value === 'inDevelopment'? 'Draft'
                  : child.status.value | camelcase}}
            </span>
            </small>
            <ng-template #popContent>
              {{ child.status.reason }}
            </ng-template>
            <small *ngIf="!child.status.reason">
              <span class="indicator" [ngClass]="child.status.value ? statusColor(child.status.value) : ''"></span>
              <span class="cursor-pointer font-med oc-text-body">
              {{child.status.value === 'inDevelopment'? 'Draft'
                  : child.status.value | camelcase}}</span>
            </small>
          </td>
          <td>
            <ng-container [ngTemplateOutletContext]="{ $implicit: {data: child, child: true, index: i} }"
                          [ngTemplateOutlet]="appMenuTemplate">
            </ng-container>
          </td>
          <td class="col-blank"></td>
        </tr>
      </ng-container>
    </ng-template>
    <tr *ngIf="!properties.data.list || properties.data.list.length == 0">
      <td class="oc-text-center" colspan="7">
        <span> No Applications Found</span>
      </td>
    </tr>
    <tr *ngIf="properties.data.list.length > 0">
      <td class="oc-text-center oc-pb-5" colspan="7">
        <span></span>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<ng-template #appMenuTemplate let-app>
  <div class="oc-text-right ellipsis cursor-pointer">
    <div ngbDropdown
         [placement]="app?.index && properties.data.list.length > 5 && app?.index >= properties.data.list.length - 2 ?
          'top-right'
         : 'bottom-right top-right'">
      <img [src]="menuUrl" alt="more-icon" class="icon-dots" ngbDropdownToggle>
      <div ngbDropdownMenu>
        <ng-container *ngFor="let menuAction of properties.options">
          <button *ngIf="needToShowItem(menuAction, app.data?.status.value)"
                  (click)="action(menuAction, app.data?.appId, app.data?.version, app.child)"
                  ngbDropdownItem
                  class="menu" [ngClass]="'menu-' + menuAction | lowercase" >
            {{menuAction | titlecase}}
          </button>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>

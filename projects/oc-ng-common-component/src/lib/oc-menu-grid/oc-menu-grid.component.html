<table class="table"
       [infiniteScrollThrottle]="50"
       (scrolled)="onScrollDown()"
       infiniteScroll>
  <thead>
  <tr>
    <th class="placeholder"></th>
    <th class="name">App Name
      <img [src]="sortIcon" alt="icon" class="cursor-pointer icon-down"
           *ngIf="sortIcon" (click)="sortAppsBy('name')">
      <fa-icon icon="angle-down" class="cursor-pointer angle"
               *ngIf="!sortIcon" (click)="sortAppsBy('name')"></fa-icon>
    </th>
    <th class="summary">Summary</th>
    <th class="data">Data Added
      <img [src]="sortIcon" alt="icon" class="cursor-pointer icon-down"
           *ngIf="sortIcon" (click)="sortAppsBy('date')">
      <fa-icon icon="angle-down" class="cursor-pointer angle"
               *ngIf="!sortIcon" (click)="sortAppsBy('date')"></fa-icon>
    </th>
    <th class="status">Status
      <img [src]="sortIcon" alt="icon" class="cursor-pointer icon-down"
           *ngIf="sortIcon" (click)="sortAppsBy('status')">
      <fa-icon icon="angle-down" class="cursor-pointer angle"
               *ngIf="!sortIcon" (click)="sortAppsBy('status')"></fa-icon>
    </th>
    <th class="action"></th>
    <th class="placeholder"></th>
  </tr>
  </thead>
  <tbody>
  <ng-template [ngForOf]="properties.data.list" let-app ngFor>
    <tr>
      <td class="col-blank"></td>
      <td (click)="showChildrenById(app.appId)"
          [class.cursor-pointer]="app.children && app.children.length > 0">
        <div class="row">
          <div class="col-md-auto">
            <img [src]="app.customData.icon ? app.customData.icon : defaultAppIcon" alt="" class="app-icon">
          </div>
          <div class="col-md pl-0">
            <h6 class="mb-0 cursor-pointer pr-2 word-break">{{app.name}} </h6>
            <small> v {{app.version}}</small>
          </div>
        </div>
      </td>
      <td>
        <span class="summary-text">{{app.customData.summary ? app.customData.summary : ''}}</span>
      </td>
      <td>
        <span>{{app.created | date:'M/d/yyyy'}}</span>
      </td>
      <td>
        <small *ngIf="app.status.reason">
          <span class="indicator" [ngClass]="app.status.value ? statusColor(app.status.value) : ''"></span>
          <span [ngbPopover]="popContent"
                  class="cursor-pointer font-med text-body" placement="bottom"
                  popoverClass="popover shadow-sm bg-white rounded"
                  popoverTitle="Status Change Reason"
                  triggers="hover">
                {{app.status.value === 'inDevelopment'? 'Draft'
                : app.status.value | camelcase}}
            </span>
        </small>
        <ng-template #popContent>
          {{ app.status.reason }}
        </ng-template>
        <small *ngIf="!app.status.reason">
          <span class="indicator" [ngClass]="app.status.value ? statusColor(app.status.value) : ''"></span>
          <span class="cursor-pointer font-med text-body">
            {{app.status.value === 'inDevelopment'? 'Draft'
              : app.status.value | camelcase}}</span>
        </small>
      </td>
      <td>
        <ng-container [ngTemplateOutletContext]="{ $implicit: app }" [ngTemplateOutlet]="appMenuTemplate">
        </ng-container>
      </td>
      <td class="col-blank"></td>
    </tr>
    <ng-container *ngIf="app.children && app.children.length > 0">
      <tr *ngFor="let child of app?.children; let i = index" [class.d-none]="this.displayChildrenId !== app.appId">
        <td class="col-blank"></td>
        <td>
          <div class="row">
            <div class="col-md-auto">
              <img alt="icon" class="px-3" src="assets/img/line-arrow-down.svg" *ngIf="i === 0">
              <span *ngIf="i > 0" class="px-4"></span>
              <img [src]="child.customData.icon" alt="" class="app-icon">
            </div>
            <div class="col-md pl-0">
              <h6 class="mb-0 cursor-pointer pr-2 word-break">{{child.name}}</h6>
              <small>v {{child.version}}</small>
            </div>
          </div>
        </td>
        <td>
          <span class="summary-text">{{child.customData.summary ? child.customData.summary : ''}}</span>
        </td>
        <td>
          <span>{{child.created | date:'M/d/yyyy'}}</span>
        </td>
        <td>
          <small *ngIf="child.status.reason">
            <span class="indicator" [ngClass]="child.status.value ? statusColor(app.status.value) : ''"></span>
            <span [ngbPopover]="popContent"
                  class="cursor-pointer font-med text-body" placement="bottom"
                  popoverClass="popover shadow-sm bg-white rounded"
                  popoverTitle="Status Change Reason"
                  triggers="hover">
                {{child.status.value === 'inDevelopment'? 'Draft'
                 : child.status.value | camelcase}}
            </span>
          </small>
          <ng-template #popContent>
            {{ child.status.reason }}
          </ng-template>
          <small *ngIf="!child.status.reason">
            <span class="indicator" [ngClass]="child.status.value ? statusColor(app.status.value) : ''"></span>
            <span class="cursor-pointer font-med text-body">
              {{child.status.value === 'inDevelopment'? 'Draft'
                : child.status.value | camelcase}}</span>
          </small>
        </td>
        <td>
          <ng-container [ngTemplateOutletContext]="{ $implicit: child }" [ngTemplateOutlet]="appMenuTemplate">
          </ng-container>
        </td>
        <td class="col-blank"></td>
      </tr>
    </ng-container>
  </ng-template>
  <tr *ngIf="!properties.data.list || properties.data.list.length == 0">
    <td class="text-center" colspan="7">
      <span> No Applications Found</span>
    </td>
  </tr>
  <tr *ngIf="properties.data.list.length > 0">
    <td class="text-center pb-5" colspan="7">
      <span></span>
    </td>
  </tr>
  </tbody>
</table>

<ng-template #appMenuTemplate let-app>
  <div class="text-right ellipsis cursor-pointer">
    <div ngbDropdown placement="bottom-right">
      <img [src]="menuUrl" alt="more-icon" class="icon-dots" ngbDropdownToggle>
      <div ngbDropdownMenu>
        <ng-container *ngFor="let menuAction of properties.options">
          <button *ngIf="needToShowItem(menuAction, app?.status.value)"
                  (click)="action(menuAction, app?.appId, app?.version)"
                  ngbDropdownItem
                  class="menu" [ngClass]="'menu-' + menuAction | lowercase" >
            {{menuAction | titlecase}}
          </button>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>

<table class="table">
    <thead>
        <tr>
            <th class="placeholder"></th>
            <th class="name">App Name
                <a (click)="sortAppsBy('name')" class="cursor-pointer">
                    <img [src]="sortIcon" class="icon-down" alt="icon" [ngClass]="{'upside-down': sortBy=='name' && sortOrder=='-1'}" >
                </a>
            </th>
            <th class="summary">Summary</th>
            <th class="data">Data Added
                <a (click)="sortAppsBy('date')" class="cursor-pointer">
                    <img [src]="sortIcon" class="icon-down" alt="icon" [ngClass]="{'upside-down': sortBy=='date' && sortOrder=='-1'}">
                </a>
            </th>
            <th class="status">Status
                <a (click)="sortAppsBy('status')" class="cursor-pointer">
                    <img [src]="sortIcon" class="icon-down" alt="icon" [ngClass]="{'upside-down': sortBy=='status' && sortOrder=='-1'}">
                </a>
            </th>
            <th class="action"></th>
            <th class="placeholder"></th>
        </tr>
    </thead>
    <tbody>
        <ng-template ngFor let-app [ngForOf]="appList.list">
            <tr>
                <td class="col-blank"></td>
                <td>
                    <div class="row">
                        <div class="col-md-auto cursor-pointer" (click)="action('edit' , app)">
                            <img class="app-icon" [src]="app.customData.icon" alt="">
                        </div>
                        <div class="col-md pl-0">
                            <h6 class="mb-0 cursor-pointer" (click)="action('edit' , app)">{{app.name}} </h6>
                            <small> v {{app.version}}</small>

                        </div>
                    </div>
                </td>
                <td>
                    <span
                        class="summary-text">{{app.customData['summary-plain-text'] != 'undefined' ? app.customData['summary-plain-text']:''}}</span>
                </td>
                <td>
                    <span>{{app.created | date:'M/d/yyyy'}}</span>
                </td>

                <td>
                    <small *ngIf="app.prettyStatusReason"><span class="cursor-pointer font-med text-primary"
                            [ngbPopover]="popContent" placement="bottom"
                            popoverClass="popover shadow-sm bg-white rounded" triggers="hover"
                            popoverTitle="Status Change Reason">{{app.prettyStatus}}</span>

                    </small>
                    <ng-template #popContent>
                        {{ app.prettyStatusReason }}
                    </ng-template>
                    <small *ngIf="!app.prettyStatusReason"> <span
                            class="cursor-pointer font-med text-primary">{{app.prettyStatus}}</span>
                    </small>
                </td>
                <td>
                    <ng-container [ngTemplateOutlet]="appMenuTemplate" [ngTemplateOutletContext]="{ $implicit: app }">
                    </ng-container>

                </td>
                <td class="col-blank"></td>
            </tr>
            <tr *ngFor="let child of app.childs">
                <td class="col-blank"></td>
                <td>
                    <div class="row">
                        <div class="col-md-auto cursor-pointer" (click)="action('edit' , child)">
                            <img src="assets/img/line-arrow-down.svg" class="px-3" alt="icon">
                            <img [src]="child.customData.icon" alt="" class="app-icon" alt="">
                        </div>
                        <div class="col-md pl-0">
                            <h6 (click)="action('edit' , child)" class="mb-0 cursor-pointer">{{child.name}} </h6>
                            <small>v {{child.version}}</small>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="summary-text">
                        {{child.customData['summary-plain-text'] != 'undefined' ? child.customData['summary-plain-text']:''}}
                    </span>
                </td>
                <td>
                    <span>{{child.created | date:'M/d/yyyy'}}</span>
                </td>
                <td>
                    <small *ngIf="child.prettyStatusReason"><span class="cursor-pointer font-med text-primary"
                            [ngbPopover]="popContent" placement="bottom"
                            popoverClass="popover shadow-sm bg-white rounded" triggers="hover"
                            popoverTitle="Status Change Reason">{{child.prettyStatus}}</span>

                    </small>
                    <ng-template #popContent>
                        {{ child.prettyStatusReason }}
                    </ng-template>
                    <small *ngIf="!child.prettyStatusReason"> <span
                            class="cursor-pointer font-med text-primary">{{child.prettyStatus}}</span>
                    </small>
                </td>
                <td>
                    <ng-container [ngTemplateOutlet]="appMenuTemplate" [ngTemplateOutletContext]="{ $implicit: child }">
                    </ng-container>
                </td>
                <td class="col-blank"></td>
            </tr>
        </ng-template>
        <tr *ngIf="!appList || appList.list.length == 0">
            <td colspan="7" class="text-center">
                <span> No Applications Found</span>
            </td>
        </tr>
        <!-- <tr *ngIf="appList?.list.length > 0">
            <td colspan="7" class="text-center pb-5">
                <span></span>
            </td>
        </tr> -->
        <tr>
            <td colspan="7">
                <div class="col-md-12 pr-5">
                    <ngb-pagination class="d-flex justify-content-end" [pageSize]="pageSize" [collectionSize]="appList.count" [page]="appList.pageNumber" (pageChange)="updatePage($event)"  [maxSize]="appList.pages" [rotate]="true" [boundaryLinks]="true"></ngb-pagination>
                </div>
            </td>
        </tr>
    </tbody>
</table>

<ng-template #appMenuTemplate let-app>
    <div class="text-right ellipsis cursor-pointer">
        <div ngbDropdown placement="bottom-right">
            <img [src]="menuUrl" class="icon-dots" alt="more-icon" ngbDropdownToggle>
            <div ngbDropdownMenu>
                <button class="menu menu-submit"
                    *ngIf="app.prettyStatus != 'In Review' && app.prettyStatus != 'Approved' && app.prettyStatus != 'Suspended' && app.prettyStatus != 'Draft' && app.prettyStatus != 'Rejected'"
                    (click)="action('submit' , app)" ngbDropdownItem>
                    Submit
                </button>
                <button class="menu menu-edit" (click)="action('edit' , app)" ngbDropdownItem>
                     Edit
                </button>
                <button class="menu menu-del" (click)="action('delete' , app)" ngbDropdownItem>
                    Delete
                </button>

                <div *ngIf="app.prettyStatus === 'Approved'">
                    <button class="menu menu-suspend"  (click)="action('suspend' , app)" ngbDropdownItem>
                        Suspend
                    </button>
                </div>

                <div *ngIf="app.prettyStatus === 'Suspended'">
                    <button class="menu menu-unsuspend" (click)="action('unsuspend' , app)" ngbDropdownItem>
                        Unsuspend
                    </button>
                </div>
            </div>
        </div>
    </div>
</ng-template>
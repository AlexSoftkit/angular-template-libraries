<table aria-describedby="user-management-table"
       class="table"
       [infiniteScrollThrottle]="50"
       (scrolled)="onScrollDown()"
       infiniteScroll>
    <thead>
        <tr>
            <ng-container [ngTemplateOutletContext]="{$implicit:{width: 'name', name: 'Name', field: 'name'}}"
                          [ngTemplateOutlet]="sortIconTemplate">
            </ng-container>
            <ng-container [ngTemplateOutletContext]="{$implicit:{width: 'email',name: 'Email', field: 'email'}}"
                          [ngTemplateOutlet]="sortIconTemplate">
            </ng-container>
            <ng-container [ngTemplateOutletContext]="{$implicit:{width: 'data', name: 'Date Added', field: 'date'}}"
                          [ngTemplateOutlet]="sortIconTemplate">
            </ng-container>
            <ng-container [ngTemplateOutletContext]="{$implicit:{width: 'role', name: 'Role', field: 'role'}}"
                          [ngTemplateOutlet]="sortIconTemplate">
            </ng-container>
            <th class="status" scope="col">
                <div class="th-row">Status</div>
            </th>
            <th class="action" scope="col"></th>
        </tr>
    </thead>
    <tbody>
    <ng-template [ngForOf]="properties.data.list" let-user let-i="index" ngFor>
        <tr [class.highlight-user]="user.inviteStatus === 'INVITED'">
            <!-- Name -->
            <td>
                <div class="td-row">
                    <div class="profile" [class.profile--invited]="user.inviteStatus === 'INVITED'">{{initials(user)}}</div>
                    <span class="c-dark oc-font-weight-bold">{{user.name}}</span>
                </div>
            </td>
            <!-- Email -->
            <td>
                <div class="td-row">
                    <span class="c-gray">{{user.email}}</span>
                </div>
            </td>
            <!-- Date Added -->
            <td>
                <div class="td-row">
                    <span class="c-gray">{{user.created | date:'M/d/yyyy'}}</span>
                </div>
            </td>
            <!-- Role -->
            <td>
                <div class="td-row">
                    <span class="c-blue oc-text-capitalize font-weight-bold">
                        {{(user?.roles?.length > 0 ? user.roles[0]: '') | lowercase}} </span>
                </div>
            </td>
            <!-- Status-->
            <td>
                <div class="td-row"
                     [ngClass]="user.inviteStatus === 'ACTIVE' ? 'c-dark' : 'c-gray'">
                    <span class="oc-text-capitalize oc-font-weight-bold"
                          [class.font-weight-bold]="user.inviteStatus === 'ACTIVE'">
                        {{user.inviteStatus | lowercase}}
                    </span>
                </div>
            </td>
            <!-- Options -->
            <td class="action-menu">
                <ng-container [ngTemplateOutletContext]="{ $implicit: {data: user, child: false, index: i} }"
                              [ngTemplateOutlet]="appMenuTemplate">
                </ng-container>
            </td>
        </tr>
    </ng-template>
    <tr *ngIf="!properties.data.list || properties.data.list.length == 0">
        <td class="oc-text-center last-grid-row" colspan="8">
            <span>No Users Found</span>
        </td>
    </tr>
    <tr *ngIf="properties.data.list.length > 0">
        <td class="oc-text-center last-grid-row oc-pb-5" colspan="8">
            <span></span>
        </td>
    </tr>
    </tbody>
</table>

<ng-template #appMenuTemplate let-user>
    <div class="oc-text-right ellipsis cursor-pointer">
        <div ngbDropdown placement="bottom-right top-right">
            <img [src]="menuUrl" alt="more-icon" class="icon-dots" ngbDropdownToggle>
            <div ngbDropdownMenu>
                <ng-container *ngFor="let menuAction of properties.options">
                    <button (click)="action(menuAction, user.data)"
                            ngbDropdownItem
                            class="menu" [ngClass]="'menu-' + menuAction | lowercase">
                        {{menuAction | titlecase}}
                    </button>
                </ng-container>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #sortIconTemplate let-column>
    <th [ngClass]="column.width" scope="col">
        <div class="th-row cursor-pointer" (click)="sortUsersBy(column.field)">{{column.name}}
            <div class="sort-icon">
                <img [src]="sortIcon" alt="icon" class="cursor-pointer icon-down" *ngIf="sortIcon">
                <svg-icon *ngIf="!sortIcon" src="assets/oc-ng-common-component/dropdown.svg" class="cursor-pointer"></svg-icon>
            </div>
        </div>
    </th>
</ng-template>
